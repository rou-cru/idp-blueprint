# @section -- High Availability
ha:
  # -- (bool) Enable High Availability mode for production deployments
  enabled: false

# @section -- Authentication
dex:
  # -- (bool) Enable Dex federated OpenID Connect provider
  enabled: false

# -- (bool) Create cluster roles for ArgoCD
# @section -- RBAC
createClusterRoles: true

# @section -- TLS
certificate:
  # -- (bool) Enable certificate management (handled by cert-manager)
  enabled: false
  # -- (string) Global logging format
  format: json
  # -- (string) Global logging level
  level: warn

# @section -- Controller
controller:
  # -- (string) Priority class for controller pods
  priorityClassName: platform-infrastructure
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: role
                operator: In
                values:
                  - infra
                  - apps
  # -- Rolling update strategy for zero-downtime updates
  deploymentStrategy:
    type: RollingUpdate
    rollingUpdate:
      # -- (int) Maximum unavailable pods during update (0 for zero-downtime)
      maxUnavailable: 0
      # -- (int) Maximum surge pods during update
      maxSurge: 1
  resources:
    requests:
      # -- (string) CPU request
      cpu: 250m
      # -- (string) Memory request
      memory: 512Mi
    limits:
      # -- (string) CPU limit
      cpu: 1000m
      # -- (string) Memory limit
      memory: 1Gi
  metrics:
    # -- (bool) Enable Prometheus metrics
    enabled: true
    serviceMonitor:
      # -- (bool) Enable ServiceMonitor for Prometheus Operator
      enabled: true
      # -- (string) Scrape interval for GitOps reconciliation tracking
      interval: 30s
      # -- (string) Scrape timeout
      scrapeTimeout: 25s

# @section -- Server
server:
  # -- (string) Priority class for server pods
  priorityClassName: platform-infrastructure
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: role
                operator: In
                values:
                  - infra
                  - apps
  # -- Rolling update strategy for zero-downtime updates
  deploymentStrategy:
    type: RollingUpdate
    rollingUpdate:
      # -- (int) Maximum unavailable pods during update (0 for zero-downtime)
      maxUnavailable: 0
      # -- (int) Maximum surge pods during update
      maxSurge: 1
  resources:
    requests:
      # -- (string) CPU request
      cpu: 125m
      # -- (string) Memory request
      memory: 128Mi
    limits:
      # -- (string) CPU limit
      cpu: 250m
      # -- (string) Memory limit
      memory: 256Mi
  metrics:
    # -- (bool) Enable metrics
    enabled: true
    serviceMonitor:
      # -- (bool) Enable ServiceMonitor
      enabled: true
      # -- (string) Scrape interval for user-facing API latency
      interval: 30s
      # -- (string) Scrape timeout
      scrapeTimeout: 25s
  ingress:
    # -- (bool) Enable ingress
    enabled: false
    # -- (bool) Enable TLS
    tls: false

# @section -- Repository Server
repoServer:
  # -- (string) Priority class
  priorityClassName: platform-infrastructure
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: role
                operator: In
                values:
                  - infra
                  - apps
  # -- Rolling update strategy for zero-downtime updates
  deploymentStrategy:
    type: RollingUpdate
    rollingUpdate:
      # -- (int) Maximum unavailable pods during update (0 for zero-downtime)
      maxUnavailable: 0
      # -- (int) Maximum surge pods during update
      maxSurge: 1
  resources:
    requests:
      # -- (string) CPU request
      cpu: 250m
      # -- (string) Memory request
      memory: 256Mi
    limits:
      # -- (string) CPU limit
      cpu: 500m
      # -- (string) Memory limit
      memory: 512Mi
  metrics:
    # -- (bool) Enable metrics
    enabled: true
    serviceMonitor:
      # -- (bool) Enable ServiceMonitor
      enabled: true
      # -- (string) Scrape interval for background git operations
      interval: 60s
      # -- (string) Scrape timeout
      scrapeTimeout: 40s

# @section -- Redis
redis:
  # -- Rolling update strategy for zero-downtime updates
  deploymentStrategy:
    type: RollingUpdate
    rollingUpdate:
      # -- (int) Maximum unavailable pods during update (0 for zero-downtime)
      maxUnavailable: 0
      # -- (int) Maximum surge pods during update
      maxSurge: 1
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: role
                operator: In
                values:
                  - infra
                  - apps
  resources:
    requests:
      # -- (string) CPU request
      cpu: 100m
      # -- (string) Memory request
      memory: 128Mi
    limits:
      # -- (string) CPU limit
      cpu: 250m
      # -- (string) Memory limit
      memory: 256Mi

# @section -- ApplicationSet
applicationSet:
  # -- (string) Priority class
  priorityClassName: platform-infrastructure
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          preference:
            matchExpressions:
              - key: role
                operator: In
                values:
                  - infra
                  - apps
  # -- (bool) Enable ApplicationSet controller
  enabled: true
  # -- Rolling update strategy for zero-downtime updates
  deploymentStrategy:
    type: RollingUpdate
    rollingUpdate:
      # -- (int) Maximum unavailable pods during update (0 for zero-downtime)
      maxUnavailable: 0
      # -- (int) Maximum surge pods during update
      maxSurge: 1
  resources:
    requests:
      # -- (string) CPU request
      cpu: 125m
      # -- (string) Memory request
      memory: 256Mi
    limits:
      # -- (string) CPU limit
      cpu: 250m
      # -- (string) Memory limit
      memory: 512Mi
  metrics:
    # -- (bool) Enable metrics
    enabled: true
    serviceMonitor:
      # -- (bool) Enable ServiceMonitor
      enabled: true
      # -- (string) Scrape interval for template rendering
      interval: 60s
      # -- (string) Scrape timeout
      scrapeTimeout: 40s

# @section -- CRDs
crds:
  # -- (bool) Install CRDs
  install: true
  # -- (bool) Keep CRDs on chart uninstall
  keep: true

# @section -- Configuration
configs:
  # -- ArgoCD server command-line parameters
  # Required for TLS termination at reverse proxy/gateway
  params:
    # -- (bool) Run server without TLS (required when behind TLS-terminating proxy)
    # The Gateway handles TLS termination, so ArgoCD receives plain HTTP
    server.insecure: true
  secret:
    # -- (bool) Create secret for admin credentials
    createSecret: true
    # -- (string) Admin password hash (managed by Vault)
    # @default -- Vault-generated bcrypt hash
    argocdServerAdminPassword: '$2a$10$tYFiS1qMKY8rUMgc/a31TO19Rhg7auvSye9Vx8opYY/8rnUwfTaSO'
  cm:
    # -- (string) ArgoCD server URL for redirects and notifications
    # Dynamically injected via --set in bootstrap task using DNS_SUFFIX variable
    url: https://argocd.${DNS_SUFFIX}
    # -- (string) Enable Helm support in Kustomize builds
    kustomize.buildOptions: "--enable-helm"
    # -- (string) Resource tracking method for performance
    application.resourceTrackingMethod: annotation
    # -- (string) Enable status badges
    statusbadge.enabled: true
    # -- (string) Exclude high-frequency resources from reconciliation
    resource.exclusions: |
      ### Network resources created by the Kubernetes control plane and excluded to reduce the number of watched events and UI clutter
      - apiGroups:
        - ''
        - discovery.k8s.io
        kinds:
        - Endpoints
        - EndpointSlice
      ### Internal Kubernetes resources excluded reduce the number of watched events
      - apiGroups:
        - coordination.k8s.io
        kinds:
        - Lease
      ### Internal Kubernetes Authz/Authn resources excluded reduce the number of watched events
      - apiGroups:
        - authentication.k8s.io
        - authorization.k8s.io
        kinds:
        - SelfSubjectReview
        - TokenReview
        - LocalSubjectAccessReview
        - SelfSubjectAccessReview
        - SelfSubjectRulesReview
        - SubjectAccessReview
      ### Intermediate Certificate Request excluded reduce the number of watched events
      - apiGroups:
        - certificates.k8s.io
        kinds:
        - CertificateSigningRequest
      - apiGroups:
        - cert-manager.io
        kinds:
        - CertificateRequest
      ### Cilium internal resources excluded reduce the number of watched events and UI Clutter
      - apiGroups:
        - cilium.io
        kinds:
        - CiliumIdentity
        - CiliumEndpoint
        - CiliumEndpointSlice
      ### Kyverno intermediate and reporting resources excluded reduce the number of watched events and improve performance
      - apiGroups:
        - kyverno.io
        - reports.kyverno.io
        - wgpolicyk8s.io
        kinds:
        - PolicyReport
        - ClusterPolicyReport
        - EphemeralReport
        - ClusterEphemeralReport
        - AdmissionReport
        - ClusterAdmissionReport
        - BackgroundScanReport
        - ClusterBackgroundScanReport
        - UpdateRequest
    # -- Global ignoreDifferences customizations
    resource.customizations.ignoreDifferences.ConfigMap: |
      jsonPointers:
        - /data
    resource.customizations.ignoreDifferences.Secret: |
      jsonPointers:
        - /data
        - /metadata/labels
    resource.customizations.ignoreDifferences.ServiceAccount: |
      jsonPointers:
        - /secrets
    resource.customizations.ignoreDifferences.admissionregistration.k8s.io_MutatingWebhookConfiguration: |
      jqPathExpressions:
        - ".webhooks[]?.clientConfig.caBundle"
    resource.customizations.ignoreDifferences.admissionregistration.k8s.io_ValidatingWebhookConfiguration: |
      jqPathExpressions:
        - ".webhooks[]?.clientConfig.caBundle"
    resource.customizations.ignoreDifferences.external-secrets.io_ExternalSecret: |
      jsonPointers:
        - /status
        - /metadata/generation
        - /spec/target/deletionPolicy
        - /spec/target/template/metadata
        - /spec/target/template/engineVersion
        - /spec/target/template/mergePolicy
        - /spec/target/template/type
      jqPathExpressions:
        - .spec.data[]?.remoteRef.conversionStrategy
        - .spec.data[]?.remoteRef.decodingStrategy
        - .spec.data[]?.remoteRef.metadataPolicy
        - .spec.dataFrom[]?.extract.conversionStrategy
        - .spec.dataFrom[]?.extract.decodingStrategy
        - .spec.dataFrom[]?.extract.metadataPolicy
    resource.customizations.ignoreDifferences.apps_StatefulSet: |
      jsonPointers:
        - /status
    resource.customizations.ignoreDifferences.kyverno.io_ClusterPolicy: |
      jsonPointers:
        - /status
        - /spec/admission
        - /spec/emitWarning
        - /metadata/annotations
      jqPathExpressions:
        - .spec.rules[] | select(.name|test("autogen-"))
    resource.customizations.ignoreDifferences.pyrra.dev_ServiceLevelObjective: |
      jsonPointers:
        - /status
    # -- (bool) Enable exec feature in Argo UI
    exec.enabled: true
    # -- (bool) Enable local admin user
    admin.enabled: true
    # -- (string) Timeout to discover new manifest versions
    timeout.reconciliation: 60s
  # @section -- Repositories
  repositories:
    argo-project:
      # -- (string) Repository name
      name: argo-project
      # -- (string) Repository URL
      url: https://argoproj.github.io/argo-helm
      # -- (string) Repository type
      type: helm
    prometheus-community:
      # -- (string) Repository name
      name: prometheus-community
      # -- (string) Repository URL
      url: https://prometheus-community.github.io/helm-charts
      # -- (string) Repository type
      type: helm
    grafana:
      # -- (string) Repository name
      name: grafana
      # -- (string) Repository URL
      url: https://grafana.github.io/helm-charts
      # -- (string) Repository type
      type: helm
    open-telemetry:
      # -- (string) Repository name
      name: open-telemetry
      # -- (string) Repository URL
      url: https://open-telemetry.github.io/opentelemetry-helm-charts
      # -- (string) Repository type
      type: helm
    sonarsource:
      # -- (string) Repository name
      name: sonarsource
      # -- (string) Repository URL
      url: https://SonarSource.github.io/helm-chart-sonarqube
      # -- (string) Repository type
      type: helm
    external-secrets:
      # -- (string) Repository name
      name: external-secrets
      # -- (string) Repository URL
      url: https://charts.external-secrets.io
      # -- (string) Repository type
      type: helm
    jetstack:
      # -- (string) Repository name
      name: jetstack
      # -- (string) Repository URL
      url: https://charts.jetstack.io/
      # -- (string) Repository type
      type: helm
    kyverno:
      # -- (string) Repository name
      name: kyverno
      # -- (string) Repository URL
      url: https://kyverno.github.io/kyverno/
      # -- (string) Repository type
      type: helm
    aqua:
      # -- (string) Repository name
      name: aqua
      # -- (string) Repository URL
      url: https://aquasecurity.github.io/helm-charts/
      # -- (string) Repository type
      type: helm
    policy-reporter:
      # -- (string) Repository name
      name: policy-reporter
      # -- (string) Repository URL
      url: https://kyverno.github.io/policy-reporter
      # -- (string) Repository type
      type: helm
    bitnami:
      # -- (string) Repository name
      name: bitnami
      # -- (string) Repository URL
      url: https://charts.bitnami.com/bitnami
      # -- (string) Repository type
      type: helm
    fluent:
      # -- (string) Repository name
      name: fluent
      # -- (string) Repository URL
      url: https://fluent.github.io/helm-charts
      # -- (string) Repository type
      type: helm
    pixie-operator:
      # -- (string) Repository name
      name: pixie-operator
      # -- (string) Repository URL
      url: https://artifacts.px.dev/helm_charts/operator
      # -- (string) Repository type
      type: helm
    hashicorp:
      # -- (string) Repository name
      name: hashicorp
      # -- (string) Repository URL
      url: https://helm.releases.hashicorp.com
      # -- (string) Repository type
      type: helm
    cilium:
      # -- (string) Repository name
      name: cilium
      # -- (string) Repository URL
      url: https://helm.cilium.io/
      # -- (string) Repository type
      type: helm

## @section High Availability
## @description Configuration for ArgoCD's High Availability mode.
# -- Disable High Availability mode to keep the deployment lightweight for the demo.
ha:
  enabled: false

## @section Dex Configuration
## @description Dex is a federated OpenID Connect provider.
# -- Disable Dex to save resources as it's not needed for this demo.
dex:
  enabled: false

# -- Create cluster roles for ArgoCD.
createClusterRoles: true

# -- Disable certificate management, as it is handled by cert-manager.
certificate:
  enabled: false
  # -- Sets the global logging format.
  format: json
  # -- Sets the global logging level.
  level: warn

## @section Resource Optimization
## @description Set low resource requests and limits for the main components to optimize for a demo environment.
controller:
  priorityClassName: platform-infrastructure
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      # -- Higher frequency for GitOps reconciliation tracking
      interval: 30s
      scrapeTimeout: 25s

server:
  priorityClassName: platform-infrastructure
  resources:
    requests:
      cpu: 125m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      # -- Higher frequency for user-facing API latency metrics
      interval: 30s
      scrapeTimeout: 25s
  ingress:
    enabled: false
    tls: false

repoServer:
  priorityClassName: platform-infrastructure
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      # -- Standard frequency for background git fetch operations
      interval: 60s
      scrapeTimeout: 40s

## @section Redis Configuration
## @description Resource settings for the bundled Redis cache.
redis:
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

## @section Feature Flags
## @description Toggles for core ArgoCD features.
# -- Enable the ApplicationSet controller, which is key to our GitOps strategy.
applicationSet:
  priorityClassName: platform-infrastructure
  enabled: true
  resources:
    requests:
      cpu: 125m
      memory: 256Mi
    limits:
      cpu: 250m
      memory: 512Mi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      # -- Standard frequency for ApplicationSet template rendering
      interval: 60s
      scrapeTimeout: 40s

crds:
  install: true
  # -- Keep CRDs on chart uninstall.
  keep: true

## @section Secret Management
## @description ArgoCD admin password from Vault-generated Secret
configs:
  secret:
    createSecret: true
    # -- Placeholder for admin password. Vault is the source of truth.
    argocdServerAdminPassword: '$2a$10$tYFiS1qMKY8rUMgc/a31TO19Rhg7auvSye9Vx8opYY/8rnUwfTaSO'
  ## @section Kustomize Configuration
  ## @description Enable Helm support in Kustomize globally
  cm:
    # -- Enable Helm charts in Kustomize builds
    kustomize.buildOptions: "--enable-helm"
    # -- Use annotation-based tracking for better performance
    application.resourceTrackingMethod: annotation
    # -- Enable status badge for applications
    statusbadge.enabled: true
    # -- Exclude high-frequency resources from reconciliation
    resource.exclusions: |
      ### Network resources created by the Kubernetes control plane and excluded to reduce the number of watched events and UI clutter
      - apiGroups:
        - ''
        - discovery.k8s.io
        kinds:
        - Endpoints
        - EndpointSlice
      ### Internal Kubernetes resources excluded reduce the number of watched events
      - apiGroups:
        - coordination.k8s.io
        kinds:
        - Lease
      ### Internal Kubernetes Authz/Authn resources excluded reduce the number of watched events
      - apiGroups:
        - authentication.k8s.io
        - authorization.k8s.io
        kinds:
        - SelfSubjectReview
        - TokenReview
        - LocalSubjectAccessReview
        - SelfSubjectAccessReview
        - SelfSubjectRulesReview
        - SubjectAccessReview
      ### Intermediate Certificate Request excluded reduce the number of watched events
      - apiGroups:
        - certificates.k8s.io
        kinds:
        - CertificateSigningRequest
      - apiGroups:
        - cert-manager.io
        kinds:
        - CertificateRequest
      ### Cilium internal resources excluded reduce the number of watched events and UI Clutter
      - apiGroups:
        - cilium.io
        kinds:
        - CiliumIdentity
        - CiliumEndpoint
        - CiliumEndpointSlice
      ### Kyverno intermediate and reporting resources excluded reduce the number of watched events and improve performance
      - apiGroups:
        - kyverno.io
        - reports.kyverno.io
        - wgpolicyk8s.io
        kinds:
        - PolicyReport
        - ClusterPolicyReport
        - EphemeralReport
        - ClusterEphemeralReport
        - AdmissionReport
        - ClusterAdmissionReport
        - BackgroundScanReport
        - ClusterBackgroundScanReport
        - UpdateRequest
    # -- Enable exec feature in Argo UI
    exec.enabled: true
    # -- Enable local admin user
    admin.enabled: true
    # -- Timeout to discover if a new manifests version got published to the repository
    timeout.reconciliation: 180s
  ## @section Repository Configuration
  ## @description Configure Helm repositories for ArgoCD
  repositories:
    argo-project:
      name: argo-project
      url: https://argoproj.github.io/argo-helm
      type: helm
    prometheus-community:
      name: prometheus-community
      url: https://prometheus-community.github.io/helm-charts
      type: helm
    grafana:
      name: grafana
      url: https://grafana.github.io/helm-charts
      type: helm
    open-telemetry:
      name: open-telemetry
      url: https://open-telemetry.github.io/opentelemetry-helm-charts
      type: helm
    sonarsource:
      name: sonarsource
      url: https://SonarSource.github.io/helm-chart-sonarqube
      type: helm
    external-secrets:
      name: external-secrets
      url: https://charts.external-secrets.io
      type: helm
    jetstack:
      name: jetstack
      url: https://charts.jetstack.io/
      type: helm
    kyverno:
      name: kyverno
      url: https://kyverno.github.io/kyverno/
      type: helm
    aqua:
      name: aqua
      url: https://aquasecurity.github.io/helm-charts/
      type: helm
    policy-reporter:
      name: policy-reporter
      url: https://kyverno.github.io/policy-reporter
      type: helm
    # jenkins:
    #   name: jenkins
    #   url: https://charts.jenkins.io
    #   type: helm
    bitnami:
      name: bitnami
      url: https://charts.bitnami.com/bitnami
      type: helm
    fluent:
      name: fluent
      url: https://fluent.github.io/helm-charts
      type: helm
    pixie-operator:
      name: pixie-operator
      url: https://artifacts.px.dev/helm_charts/operator
      type: helm
    hashicorp:
      name: hashicorp
      url: https://helm.releases.hashicorp.com
      type: helm
    cilium:
      name: cilium
      url: https://helm.cilium.io/
      type: helm

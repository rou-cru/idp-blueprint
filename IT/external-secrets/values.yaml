# -- (string) Priority class for External Secrets Operator pods
# @section -- General Configuration
priorityClassName: platform-infrastructure

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: node-role.kubernetes.io/control-plane
              operator: Exists

tolerations:
  - key: node-role.kubernetes.io/control-plane
    operator: Exists
    effect: NoSchedule

# -- (bool) Install CRDs. Should be true for the initial installation
# @section -- CRDs
installCRDs: true

# -- (int) Number of replicas for the operator
# @section -- Deployment
replicas: 1

# -- Rolling update strategy for zero-downtime updates
deploymentStrategy:
  type: RollingUpdate
  rollingUpdate:
    # -- (int) Maximum unavailable pods during update (0 for zero-downtime)
    maxUnavailable: 0
    # -- (int) Maximum surge pods during update
    maxSurge: 1

# @section -- Resources
resources:
  requests:
    # -- (string) CPU request
    cpu: 250m
    # -- (string) Memory request
    memory: 256Mi
  limits:
    # -- (string) CPU limit
    cpu: 1000m
    # -- (string) Memory limit
    memory: 1Gi

# @section -- Health Probes
livenessProbe:
  # -- (bool) Enable liveness probe
  enabled: true
  spec:
    httpGet:
      # -- (int) Liveness probe port
      port: "http"
      # -- (string) Liveness probe path
      path: /healthz
    # -- (int) Initial delay before liveness probe
    initialDelaySeconds: 10
    # -- (int) Period between liveness probes
    periodSeconds: 10
    # -- (int) Timeout for liveness probe
    timeoutSeconds: 5
    # -- (int) Failure threshold for liveness probe
    failureThreshold: 3
readinessProbe:
  # -- (bool) Enable readiness probe
  enabled: true
  spec:
    httpGet:
      # -- (int) Readiness probe port
      port: "http"
      # -- (string) Readiness probe path
      path: /readyz
    # -- (int) Initial delay before readiness probe
    initialDelaySeconds: 20
    # -- (int) Period between readiness probes
    periodSeconds: 10
    # -- (int) Timeout for readiness probe
    timeoutSeconds: 5
    # -- (int) Failure threshold for readiness probe
    failureThreshold: 3

# -- (int) Concurrent ExternalSecret reconciliations for better performance
# @section -- Performance
concurrent: 5

# @section -- RBAC
serviceAccount:
  # -- (bool) Create service account
  create: true
  # -- (string) Service account name
  name: 'external-secrets'

# @section -- Webhook
webhook:
  # -- (string) Certificate validity lookahead interval (must be less than cert.renewBefore)
  lookaheadInterval: "168h"
  certManager:
    # -- (bool) Enable cert-manager for webhook certificates
    enabled: true
    # -- (bool) Automatically inject CA into webhooks and CRDs
    addInjectorAnnotations: true
    cert:
      # -- (bool) Create certificate resource
      create: true
      issuerRef:
        # -- (string) Issuer group
        group: cert-manager.io
        # -- (string) Issuer kind
        kind: ClusterIssuer
        # -- (string) Issuer name
        name: ca-issuer
      # -- (string) Certificate lifetime (90 days)
      duration: "2160h"
      # -- (string) Renew certificate 30 days before expiry
      renewBefore: "720h"
      privateKey:
        # -- (string) Private key rotation policy
        rotationPolicy: Always

# @section -- Observability
serviceMonitor:
  # -- (bool) Enable ServiceMonitor
  enabled: true
  # -- (string) Scrape interval
  interval: 60s
  # -- (string) Scrape timeout
  scrapeTimeout: 40s
  # -- (bool) Honor labels from service
  honorLabels: true

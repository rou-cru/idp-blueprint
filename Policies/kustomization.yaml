apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 1. Include the namespace and policy rule files as resources
resources:
  - namespace.yaml
  - rules/enforce-namespace-labels.yaml
  - rules/require-component-labels.yaml
  - rules/audit-business-labels.yaml
  - rules/audit-namespace-resource-governance.yaml

# 2. Define the Helm charts to be deployed
helmCharts:
  # Deploy Kyverno itself
  - name: kyverno
    repo: https://kyverno.github.io/kyverno/
    version: 3.2.4
    releaseName: kyverno
    namespace: kyverno # Deploy into the new, protected namespace
    valuesFile: kyverno-values.yaml

  # Deploy Policy Reporter
  - name: policy-reporter
    repo: https://kyverno.github.io/policy-reporter
    version: 2.20.1
    releaseName: policy-reporter
    namespace: kyverno # Deploy alongside Kyverno
    valuesFile: policy-reporter-values.yaml

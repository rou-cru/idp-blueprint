apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: audit-business-labels
  annotations:
    policies.kyverno.io/title: Audit Standard Business Labels
    policies.kyverno.io/category: Best Practices
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: Label, Workload
    policies.kyverno.io/description: >-
      This policy audits that all major workloads and resources include the standard
      business labels (owner, business-unit, environment). Its purpose is to detect
      resources that may have been created before label propagation was active (e.g.,
      bootstrap components) or where propagation otherwise failed. It runs in audit
      mode to avoid blocking deployments.
spec:
  validationFailureAction: audit
  background: true
  rules:
    - name: audit-business-labels-on-resources
      match:
        any:
          - resources:
              kinds:
                - Deployment
                - StatefulSet
                - DaemonSet
                - Job
                - CronJob
                - Service
                - Ingress
                - ConfigMap
      exclude:
        any:
          - resources:
              namespaces:
                - kube-system
                - kube-public
                - kube-node-lease
                - kyverno
      validate:
        message:
          'Resource must include the standard business labels: owner, business-unit,
          environment.'
        pattern:
          metadata:
            labels:
              owner: '?*'
              business-unit: '?*'
              environment: '?*'

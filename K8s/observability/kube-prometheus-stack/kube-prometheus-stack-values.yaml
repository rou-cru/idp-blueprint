## @section CRDs
## @description CRD installation configuration.
# -- Disables the installation of CRDs, as they are managed separately.
crds:
  enabled: false

## @section Alertmanager
## @description Alertmanager configuration.
alertmanager:
  # -- Disabled by default. This blueprint uses Grafana Unified Alerting as the
  # primary platform for managing alerts from all datasources (Prometheus, Loki, etc.),
  # providing a single, integrated user experience.
  enabled: false

## @section Prometheus
## @description Prometheus instance configuration.
prometheus:
  prometheusSpec:
    # -- Global scrape interval for all ServiceMonitors (unless overridden).
    scrapeInterval: 60s
    # -- Global scrape timeout for all ServiceMonitors (unless overridden).
    scrapeTimeout: 40s
    # -- Metrics retention time.
    retention: 6h
    # -- Enable persistence for Prometheus TSDB. 1Gi supports 6h retention for ~50 pods
    # with 4x overhead margin. Data survives pod restarts but is lost on cluster destruction.
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi
    # -- Resource limits and requests for Prometheus.
    resources:
      requests:
        cpu: 100m
        memory: 384Mi
      limits:
        cpu: 250m
        memory: 512Mi

## @section Grafana
## @description Grafana instance configuration.
grafana:
  # -- Enable persistence for dashboards and settings
  persistence:
    enabled: true
    type: pvc
    size: 1Gi
    accessModes: [ReadWriteOnce]
  # -- Use existing secret for admin credentials from Vault via ESO.
  admin:
    existingSecret: grafana-admin-credentials
    userKey: admin-user
    passwordKey: admin-password
  # -- Resource limits and requests for Grafana.
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi
  # -- Additional datasources for Grafana.
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki.observability.svc.cluster.local:3100
      access: proxy
      isDefault: false
  # -- Automatically install useful plugins on startup.
  plugins:
    - grafana-piechart-panel
    - grafana-polystat-panel
    - marcusolsson-json-datasource
  # -- Sidecar to automatically discover and load dashboards from ConfigMaps.
  sidecar:
    dashboards:
      enabled: true
      label: grafana_dashboard
      # -- An empty labelValue searches for the presence of the label, regardless of its value.
      labelValue: ""
  # -- Advanced Grafana configuration via grafana.ini
  grafana.ini:
    users:
      # -- Disables the user sign-up page.
      allow_sign_up: false
      # -- Set the default UI theme to dark.
      default_theme: dark

    # -- Example for Azure AD OAuth.
    # To enable, uncomment the block and provide the values, ideally via secrets.
    # auth.azuread:
    #   enabled: true
    #   name: "Azure AD"
    #   allow_sign_up: true
    #   client_id: "$AZURE_CLIENT_ID"
    #   client_secret: "$AZURE_CLIENT_SECRET"
    #   scopes: "openid email profile"
    #   auth_url: "https://login.microsoftonline.com/YOUR_TENANT_ID/oauth2/v2.0/authorize"
    #   token_url: "https://login.microsoftonline.com/YOUR_TENANT_ID/oauth2/v2.0/token"

## @section Prometheus Operator
## @description Prometheus Operator configuration.
# -- Resource limits and requests for the Prometheus Operator.
prometheusOperator:
  resources:
    requests:
      cpu: 25m
      memory: 32Mi
    limits:
      cpu: 50m
      memory: 64Mi

## @section Kube State Metrics
## @description Kube State Metrics configuration.
# -- Resource limits and requests for kube-state-metrics.
kube-state-metrics:
  # Enable only relevant resource types (whitelist approach).
  # Disables: ReplicaSets, ConfigMaps, Secrets, RBAC, HPAs, Leases, Webhooks, etc.
  extraArgs:
    - --resources=cronjobs,daemonsets,deployments,jobs,namespaces,networkpolicies,nodes,persistentvolumeclaims,persistentvolumes,pods,services,statefulsets,storageclasses
  prometheus:
    monitor:
      # Drop high-cardinality labels that add noise without operational value.
      metricRelabelings:
        # Drop uid label: UUIDs not useful in dashboards/queries
        - action: labeldrop
          regex: "uid"
        # Drop container_id: SHA256 hashes change on every restart (high churn)
        - action: labeldrop
          regex: "container_id"
        # Drop image_id: SHA256 hashes redundant with image tag
        - action: labeldrop
          regex: "image_id"
  resources:
    requests:
      cpu: 25m
      memory: 64Mi
    limits:
      cpu: 50m
      memory: 128Mi

## @section Prometheus Node Exporter
## @description Prometheus Node Exporter configuration.
# -- Resource limits and requests for the node-exporter.
prometheus-node-exporter:
  # -- Minimal collector set optimized for K3d + Cilium eBPF environments.
  # Uses whitelist approach (disable defaults, enable only essentials) to minimize overhead.
  extraArgs:
    # Disable all default collectors (40+ collectors)
    - --collector.disable-defaults
    # Enable ONLY essential collectors for K8s observability (10 collectors)
    - --collector.cpu          # CPU usage per core and aggregated
    - --collector.cpufreq      # CPU frequency scaling
    - --collector.meminfo      # Memory usage (free, cached, buffers, etc.)
    - --collector.diskstats    # Disk I/O operations and latency
    - --collector.filesystem   # Filesystem usage and inodes
    - --collector.netdev       # Network interface traffic and errors
    - --collector.loadavg      # System load averages (1m, 5m, 15m)
    - --collector.pressure     # PSI: CPU/Memory/IO pressure stall information
    - --collector.vmstat       # Virtual memory stats (paging, swapping)
    - --collector.stat         # Context switches, interrupts, forks
    - --collector.uname        # Kernel version and system metadata
  resources:
    requests:
      cpu: 15m
      memory: 24Mi
    limits:
      cpu: 30m
      memory: 48Mi

## @section Windows Exporter
## @description Windows Exporter configuration.
# -- Disables unnecessary components.
windows-exporter:
  enabled: false

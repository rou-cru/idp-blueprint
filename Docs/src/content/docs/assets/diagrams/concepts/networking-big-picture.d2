direction: right

classes: { actor: { style.fill: "#0f172a"; style.stroke: "#38bdf8"; style.font-color: white }
           gateway: { style.fill: "#0f172a"; style.stroke: "#22d3ee"; style.font-color: white }
           route: { style.fill: "#0f766e"; style.stroke: "#34d399"; style.font-color: white }
           backend: { style.fill: "#7c3aed"; style.stroke: "#a855f7"; style.font-color: white }
           pki: { style.fill: "#111827"; style.stroke: "#6366f1"; style.font-color: white } }

Client: {
  class: actor
  shape: person
  label: "User (browser/CLI)"
}

Gateway: {
  class: gateway
  shape: hexagon
  label: "Gateway API (Cilium)\nNodePort http/https\nListener: HTTPS *.nip.io"
  link: https://gateway-api.sigs.k8s.io
}

Routes: {
  class: route
  Argo: "argocd"
  Grafana: "grafana"
  Vault: "vault"
  Workflows: "workflows"
  Pyrra: "pyrra"
  Backstage: "backstage"
}

Backends: {
  class: backend
  A: "argocd-server:80"
  G: "prometheus-grafana:80"
  V: "vault:8200"
  W: "argo-workflows-server:2746"
  P: "pyrra:9099"
  B: "backstage:7007"
}

PKI: { class: pki; label: "PKI\nCA: idp-demo-ca\nIssuer: ca-issuer\nWildcard: *.nip.io" }

Client -> Gateway: HTTPS
Gateway -> Routes.Argo
Gateway -> Routes.Grafana
Gateway -> Routes.Vault
Gateway -> Routes.Workflows
Gateway -> Routes.Pyrra
Gateway -> Routes.Backstage

Routes.Argo -> Backends.A
Routes.Grafana -> Backends.G
Routes.Vault -> Backends.V
Routes.Workflows -> Backends.W
Routes.Pyrra -> Backends.P
Routes.Backstage -> Backends.B

PKI -> Gateway: "TLS termination"
direction: right

classes: {
  k8s: {
    style: {
      fill: "#111827"
      stroke: "#6366f1"
      font-color: white
    }
  }
  control: {
    style: {
      fill: "#0f172a"
      stroke: "#38bdf8"
      font-color: white
    }
  }
  data: {
    style: {
      fill: "#0f766e"
      stroke: "#34d399"
      font-color: white
    }
  }
  workload: {
    style: {
      fill: "#7c3aed"
      stroke: "#a855f7"
      font-color: white
    }
  }
}

ExternalSecret: {
  class: k8s
  label: "ExternalSecret CR"
  spec: "remoteRef:\n  key: grafana-admin"
}

ESO: {
  class: control
  label: "External Secrets Operator"
  watch: "Watches ExternalSecrets\nReconciles every 1h"
}

Vault: {
  class: data
  shape: cylinder
  label: "Vault KV v2"
  path: "secret/grafana-admin"
  link: https://www.vaultproject.io
}

K8sSecret: {
  class: k8s
  label: "Kubernetes Secret"
  data: "admin-password: <base64>"
}

Pod: {
  class: workload
  label: "Grafana Pod"
  mount: "volumeMount:\n  /etc/secrets"
}

ExternalSecret -> ESO: "triggers reconcile"
ESO -> Vault: "read secret/grafana-admin"
Vault -> ESO: "return {password: xyz}"
ESO -> K8sSecret: "create/update Secret"
K8sSecret -> Pod: "mount as volume"

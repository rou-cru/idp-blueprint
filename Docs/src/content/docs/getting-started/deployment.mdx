---
title: Deployment Guide
sidebar:
  label: Deployment Guide
  order: 4
---

import { LinkButton } from '../../../components/content/index.ts';

This is your guided tour of what “task deploy” does. It’s automated by design and converges to a working platform in minutes.

## What Happens During Deploy

- Create cluster and namespaces
- Install core infrastructure (Cilium, CRDs, cert-manager, Vault, ESO)
- Install GitOps (ArgoCD) and expose endpoints via Gateway + TLS
- Apply policies and let ApplicationSets sync the stacks – ApplicationSets
  generate the ArgoCD Applications for each stack based on folders under
  `K8s/` using sync waves to control deployment order (see [GitOps Model](../concepts/gitops-model.md#sync-waves--ordering-without-scripts) for wave definitions). Stack deployment is controlled by [fuses](../architecture/overview.md#feature-toggles-fuses) defined in `config.toml`.

### Platform Components

```d2
direction: right

classes: {
  phase: { style.fill: "#0f172a"; style.font-color: white; style.stroke: "#22d3ee" }
  leaf:  { style.fill: "#0b1224"; style.font-color: "#cbd5f5"; style.stroke: "#38bdf8" }
}

"Cluster bootstrap": {
  class: phase
  K3d: "k3d cluster + registry"
  Namespaces: "base namespaces + priority classes"
}

"Infra boot": {
  class: phase
  CRDs: "Gateway & Prom CRDs"
  Cilium: "Cilium CNI"
  CertMgr: "cert-manager + CA/issuers"
  Vault: "Vault deploy + init/unseal"
  ESO: "External Secrets Operator"
}

"GitOps & ingress": {
  class: phase
  ArgoCD: "ArgoCD + AppProjects"
  ArgoSecret: "ExternalSecret (admin)"
  Gateway: "Gateway API + wildcard TLS + NodePorts"
}

Policies: {
  class: phase
  Kyverno: "Kyverno engine"
  Reporter: "Policy Reporter"
}

"AppSets fan-out": {
  class: phase
  Observability: { class: leaf; label: "Observability" }
  CICD:          { class: leaf; label: "CI/CD" }
  Security:      { class: leaf; label: "Security" }
  Backstage:     { class: leaf; label: "Backstage" }
  Events:        { class: leaf; label: "Events (always on)" }
}

"Cluster bootstrap" -> "Infra boot" -> "GitOps & ingress" -> Policies -> "AppSets fan-out"

"AppSets fan-out".Observability -> "AppSets fan-out".CICD
"AppSets fan-out".Observability -> "AppSets fan-out".Security
"AppSets fan-out".Observability -> "AppSets fan-out".Backstage
"AppSets fan-out".Observability -> "AppSets fan-out".Events
```

## Configure via config.toml

Prefer editing `config.toml` in the repo root; tasks read all settings from there. Example:

```toml
[network]
lan_ip = "192.168.1.20"   # override auto-detected IP
# HTTP/HTTPS NodePorts used by the Gateway (k3d config and Service patch consume these)
nodeport_http = 30080
nodeport_https = 30443

[git]
repo_url = "https://github.com/rou-cru/idp-blueprint"
target_revision = "main"

[versions]
cilium = "1.18.2"
cert_manager = "v1.19.0"
vault = "0.31.0"
argocd = "8.6.0"

[passwords]
argocd_admin = "argo"
grafana_admin = "graf"
```

<div style="display: flex; gap: 0.75rem; justify-content: center; margin-top: 2rem;">
  <LinkButton href="/getting-started/quickstart/" variant="secondary" icon="arrow-left">
    Back: Quickstart
  </LinkButton>
  <LinkButton href="/getting-started/verify/" variant="primary" icon="arrow-right">
    Next: Verify Installation
  </LinkButton>
</div>
